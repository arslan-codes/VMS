<!DOCTYPE html>
<html>
<head>
    <title>Tactical Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; display: flex; height: 100vh; background: #1a1a1a; color: white; font-family: sans-serif; }
        #sidebar { width: 300px; padding: 20px; border-right: 1px solid #444; }
        #map { flex: 1; }
        .stat { margin-bottom: 20px; padding: 10px; background: #2a2a2a; border-radius: 5px; }
        .label { color: #888; font-size: 12px; }
        .val { font-size: 18px; color: #00ff41; font-family: monospace; }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>ðŸ“¡ LIVE FEED</h2>
        <div class="stat"><div class="label">IMEI</div><div id="imei" class="val">---</div></div>
        <div class="stat"><div class="label">COORDINATES</div><div id="coords" class="val">0.0, 0.0</div></div>
        <div class="stat"><div class="label">SPEED</div><div id="speed" class="val">0 km/h</div></div>
        <div class="stat"><div class="label">LAST FIX</div><div id="time" class="val">---</div></div>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Init Map
        const map = L.map('map').setView([33.6844, 73.0479], 13); // Default to Islamabad
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let marker = L.marker([0,0]).addTo(map);
        let polyline = L.polyline([], {color: 'red'}).addTo(map);

        // WebSocket Link
        const ws = new WebSocket('ws://localhost:3000');
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            // Update UI
            document.getElementById('imei').innerText = data.imei;
            document.getElementById('coords').innerText = `${data.lat.toFixed(4)}, ${data.lng.toFixed(4)}`;
            document.getElementById('speed').innerText = data.speed + " km/h";
            document.getElementById('time').innerText = data.time;

            // Update Map
            const pos = [data.lat, data.lng];
            marker.setLatLng(pos);
            polyline.addLatLng(pos);
            map.panTo(pos);
        };
    </script>
</body>
</html>